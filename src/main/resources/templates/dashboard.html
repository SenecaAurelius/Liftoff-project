<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org/">
<head th:replace="fragments :: head">
    <meta charset="UTF-8"/>
    <title>Child Dashboard</title>

</head>
<body class="container", th:userType>

<header th:replace="fragments :: header"></header>

<h1>Welcome, <span th:text="${child.firstName}"></span>!</h1>

<!-- Avatar Selection -->
<h2>Choose Your Avatar</h2>
<div class="avatar-container">
    <!-- Avatar 1 -->
    <img th:src="@{/static/images/avatar.png}" alt="Avatar 1" class="avatar" onclick="selectAvatar('@{/static/images/avatar.png}')">
    <!-- Avatar 2 -->
    <img th:src="@{/static/images/avatar2.png}" alt="Avatar 2" class="avatar" onclick="selectAvatar('@{/static/images/avatar2.png}')">
</div>

<!-- Avatar Display -->
<h2>Your Avatar</h2>
<img id="selectedAvatar" alt="Selected Avatar" class="avatar" th:src="${child.avatar}">

<h2>Chores for <span id="selectedDay"></span></h2>

<!-- Calendar -->
<div id="calendar">
    <button class="day" onclick="showChores('Sunday')">Sunday</button>
    <button class="day" onclick="showChores('Monday')">Monday</button>
    <button class="day" onclick="showChores('Tuesday')">Tuesday</button>
    <button class="day" onclick="showChores('Wednesday')">Wednesday</button>
    <button class="day" onclick="showChores('Thursday')">Thursday</button>
    <button class="day" onclick="showChores('Friday')">Friday</button>
    <button class="day" onclick="showChores('Saturday')">Saturday</button>
</div>

<!-- chores table -->
<table class="table table-striped" id="choresTable">
    <thead>
    <tr>
        <th>Name</th>
        <th>Description</th>
        <th>Reward Points</th>
        <th>Complete</th>
    </tr>
    </thead>
    <tbody id="choresBody"></tbody>
</table>

<!-- Script for showing chores and marking them complete -->
<script>
    function showChores(day) {
        document.getElementById("selectedDay").textContent = day;
        const chores = ${chores}; // Your chores data from the model
        const choresBody = document.getElementById("choresBody");
        choresBody.innerHTML = "";
        chores.filter(chore => chore.day === day).forEach(chore => {
            const row = document.createElement("tr");
            row.innerHTML = `
                <td>${chore.name}</td>
                <td>${chore.choreDescription}</td>
                <td>${chore.rewardPoints}</td>
                <td>
                    <input type="checkbox" onchange="markChoreComplete(${chore.id}, this.checked)" ${chore.completed ? 'checked' : ''}>
                </td>
            `;
            choresBody.appendChild(row);
        });
    }

    function markChoreComplete(choreId, completed) {
        // Send an AJAX request to update the chore completion status
        fetch("/updateChoreCompletion", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({ choreId, completed })
        });
    }
</script>

<!-- Avatar selection script -->
<script>
    function selectAvatar(avatarUrl) {
        // Update the avatar on the page
        document.getElementById("selectedAvatar").src = avatarUrl;

        // Send an AJAX request to update the avatar in the backend
        fetch("/updateAvatar", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({ avatarUrl })
        });
    }
</script>

<!-- Chores and Rewards -->
<h2>Earned Rewards</h2>

<table class="table table-striped">
    <thead>
    <tr>
        <th>Name</th>
        <th>Description</th>
        <th>Reward Points</th>
    </tr>
    </thead>
    <tr th:each="reward : ${earnedRewards}">
        <td th:text="${reward.name}"></td>
        <td th:text="${reward.description}"></td>
        <td th:text="${reward.points}"></td>
    </tr>
</table>

<h2>Chores</h2>

<table class="table table-striped">
    <thead>
    <tr>
        <th>Name</th>
        <th>Description</th>
        <th>Due Day</th>
        <th>Reward Points</th>
        <th>Complete</th>
    </tr>
    </thead>
    <tr th:each="chore : ${chores}">
        <td th:text="${chore.name}"></td>
        <td th:text="${chore.choreDescription}"></td>
        <td th:text="${chore.dueDay.displayName}"></td>
        <td th:text="${chore.rewardPoints}"></td>
        <td>
            <form th:action="@{/chores/markComplete}" method="post">
                <input type="hidden" name="choreId" th:value="${chore.id}" />
                <button type="submit" class="btn btn-primary">Mark Complete</button>
            </form>
        </td>
    </tr>
</table>

</body>
</html>