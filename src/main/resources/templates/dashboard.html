<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org/">
<head th:replace="fragments :: head">
    <meta charset="UTF-8"/>
    <title>Child Dashboard</title>

</head>
<body class="dashboard">

<header th:unless="${childUser}" th:replace="fragments :: header"></header>


<!--<header th:if="${childUser}" th:replace="dashfragment :: header"></header>-->

<main class="container" th:unless="${childUser}">

    <div>
    <h3>Welcome, <span th:text="${parent.firstName}"></span>!</h3>
    </div>

    <div>
        <h3 th:if="${pendingChores} and ${pendingChores.size()}">Tasks Pending Approval:</h3>
        <h3 th:unless="${pendingChores} and ${pendingChores.size()}">No Tasks Pending Approval</h3>
        <table class="table table-striped" th:if="${pendingChores} and ${pendingChores.size()}">
            <thead>
            <tr>
                <td>Task</td>
                <td>Assigned to:</td>
                <td>Reward Points</td>
                <td>Approve?</td>
            </tr>
            <tr th:each="chore : ${pendingChores}">
                <td><a th:href="'/chores/detail?choreId=' + ${chore.id}" th:text="${chore.name}"></a></td>
                <td th:text="${chore.childAssigned.firstName}"></td>
                <td th:text="${chore.rewardPoints}"></td>
                <td>
                    <form th:action="@{/chores/approve}" method="post">
                        <input type="hidden" name="choreId" th:value="${chore.id}" />
                        <button type="submit" class="btn btn-success">Approve</button>
                    </form>
                </td>

            </tr>
            </thead>

        </table>
    </div>
    <div>
        <h3>My Crew</h3>
        <div th:each="child : ${crew}">
            <div><img th:src="${child.avatar}"/></div>
            <label th:text="${child.firstName}"></label>
        </div>
        <a class="btn btn-outline-dark" href="/crew/add" role="button">Add a new Crew Member</a>
    </div>
    <div>
        <h3>Available Tasks</h3>
        <table class="table table-striped" th:if="${incompleteChores} and ${incompleteChores.size()}">
            <thead>
            <tr>
                <td>Task</td>
                <td>Assigned to:</td>
                <td>Reward Points</td>
                <td>Due Date</td>
            </tr>
            <tr th:each="chore : ${incompleteChores}">
                <td><a th:href="'/chores/detail?choreId=' + ${chore.id}" th:text="${chore.name}"></a></td>
                <td th:text="${chore.childAssigned.firstName}"></td>
                <td th:text="${chore.rewardPoints}"></td>
                <td th:text="${chore.dueDate}"></td>

            </tr>
            </thead>

        </table>
        <a class="btn btn-outline-dark" href="/chores/create" role="button">New Task</a>
    </div>
    <div>
        <h3>Recently Completed</h3>
        <table class="table table-striped"><!--th:if="${recentlyCompleted} and ${recentlyCompleted.size()}">-->
            <thead>
            <tr>
                <td>Task</td>
                <td>Assigned to:</td>
                <td>Reward Points</td>
                <td>Due Date</td>
            </tr>
            <tr th:each="chore : ${recentlyCompleted}">
                <td><a th:href="'/chores/detail?choreId=' + ${chore.id}" th:text="${chore.name}"></a></td>
                <td th:text="${chore.childAssigned.firstName}"></td>
                <td th:text="${chore.rewardPoints}"></td>
                <td th:text="${chore.dueDate}"></td>

            </tr>
            </thead>

        </table>
    </div>

</main>
<main class="container" th:if="${childUser}">
<!-- Display Selected Avatar -->
<div class="mwanzo">
    <img id="selectedAvatar" src="avatar1.png" alt="Selected Avatar" width="150" height="150">

        <select id="avatarSelect" onchange="changeAvatar()">
            <option value="images/avatar1.png">Avatar 1</option>
            <option value="images/avatar2.png">Avatar 2</option>
            <option value="images/avatar3.png">Avatar 3</option>

        </select>


    <h3>Welcome, <span th:text="${child.firstName}"></span>!
    </h3>


</div>




<!-- Calendar -->

<!-- Chores table -->
    <div class="date-picker">
        <h3>Filter Chores:</h3>
        <form th:action="@{/dashboard}" method="get">
            <input type="date" id="selectedDueDate" name="dueDate">
            <input type="text" id="selectedChoreName" name="choreName" placeholder="Chore Name">
            <button type="submit">Show Chores</button>
        </form>


        <h3>Chores for the Selected Criteria:</h3>
        <ul>
            <li th:each="chore : ${chores}" th:text="${chore.name}"></li>
        </ul>
    </div>


<!-- Chores and Rewards -->

<h2>Chores</h2>

<table class="table table-striped">
    <thead>
    <tr>
        <th>Name</th>
        <th>Description</th>
        <th>Due Date</th>
        <th>Reward Points</th>
        <th>Complete</th>
    </tr>
    </thead>
    <tr th:each="chore : ${chores}">
        <td th:text="${chore.name}"></td>
        <td th:text="${chore.choreDescription}"></td>
        <td th:text="${#temporals.format(chore.dueDate, 'yyyy-MM-dd')}"></td>
        <td th:text="${chore.rewardPoints}"></td>
        <td>
            <a th:href="@{/chores/complete(choreId=${chore.id},completed=true)}"
               class="btn btn-primary"
               th:if="${not chore.completed}">Mark as Complete</a>
            <span th:if="${chore.completed}" class="text-success">Completed</span>
        </td>
    </tr>
</table>

<h2>Earned Rewards</h2>

<table class="table table-striped">
    <thead>
    <tr>
        <th>Name</th>
        <th>Description</th>
        <th>Reward Points</th>
    </tr>
    </thead>
    <tr th:each="reward : ${earnedRewards}">
        <td th:text="${reward.name}"></td>
        <td th:text="${reward.description}"></td>
        <td th:text="${reward.points}"></td>
    </tr>
</table>

<!--Avatar script-->
<script>
    function changeAvatar() {
        const avatarSelect = document.getElementById("avatarSelect");
        const selectedAvatar = avatarSelect.value;
        const selectedAvatarImg = document.getElementById("selectedAvatar");
        selectedAvatarImg.src = selectedAvatar;
    }
</script>

</main>

</body>
</html>