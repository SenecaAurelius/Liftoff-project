<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org/">
<head th:replace="fragments :: head">
    <meta charset="UTF-8"/>
    <title>Child Dashboard</title>

</head>
<body th:if="${userType}">

<header th:replace="dashfragment :: header"></header>
<h1>Welcome, <span th:text="${child.firstName}"></span>!</h1>


<!-- Calendar -->
<h2>Chores for <span id="selectedDay"></span></h2>

<!-- Add the input field for the date picker -->
<label for="daySelect">Select a day:</label>
<select id="daySelect" onchange="showChores(this.value)">
    <option value="Sunday">Sunday</option>
    <option value="Monday">Monday</option>
    <option value="Tuesday">Tuesday</option>
    <option value="Wednesday">Wednesday</option>
    <option value="Thursday">Thursday</option>
    <option value="Friday">Friday</option>
    <option value="Saturday">Saturday</option>
</select>

<!-- chores table -->
<table class="table table-striped" id="choresTable">
    <thead>
    <tr>
        <th>Name</th>
        <th>Description</th>
        <th>Reward Points</th>
        <th>Complete</th>
    </tr>
    </thead>
    <tbody id="choresBody"></tbody>
</table>

<!-- Script for showing chores and marking them complete -->
<script>
    // Function to display the chores for the selected date
      function showChores(selectedDay) {
        document.getElementById("selectedDay").textContent = selectedDay;
        const dayButtons = document.getElementsByClassName("day");
        for (let i = 0; i < dayButtons.length; i++) {
            dayButtons[i].classList.remove("selected");
        }
        // Find the option with the selectedDay value and add the "selected" class to highlight the selected day in the dropdown
        const daySelect = document.getElementById("daySelect");
        for (let i = 0; i < daySelect.options.length; i++) {
            if (daySelect.options[i].value === selectedDay) {
                daySelect.options[i].selected = true;
                break;
            }
        }

       // chores based on the selected day(needs work)
       const chores = ${chores};
      const choresBody = document.getElementById("choresBody");
      choresBody.innerHTML = "";
       chores.filter(chore => chore.day === day).forEach(chore => {
            const row = document.createElement("tr");
          row.innerHTML = `
               <td>${chore.name}</td>
               <td>${chore.choreDescription}</td>
               <td>${chore.rewardPoints}</td>
               <td>
                <input type="checkbox" onchange="markChoreComplete(${chore.id}, this.checked)" ${chore.completed ? 'checked' : ''}
                </td>
            `;
            choresBody.appendChild(row);
        });
    }

    function markChoreComplete(choreId, completed) {
        // Send an AJAX request to update the chore completion status
        fetch("/updateChoreCompletion", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({ choreId, completed })
        });
    }

    // Function to highlight the current day on the calendar
    function highlightCurrentDay() {
        const currentDate = new Date();
        const dayOfWeek = currentDate.getDay();
        const dayButtons = document.getElementsByClassName("day");
        dayButtons[dayOfWeek].classList.add("current-day");
    }

    // Call the function to highlight the current day when the page loads
    highlightCurrentDay();

    // Initialize the date picker
    $(function() {
        $("#datepicker").datepicker({
            dateFormat: "DD",
            onSelect: function(selectedDate) {

                showChores(selectedDate);
            }
        });
    });
</script>


<!-- Avatar selection script -->
<!--script>
    function selectAvatar(avatarUrl) {
        // Update the avatar on the page
        document.getElementById("selectedAvatar").querySelector("img").src = "/images/" + {avatar.png, avatar2.png};

        // Send an AJAX request to update the avatar in the backend
        fetch("/updateAvatar", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({ avatarUrl: avatarUrl, avatarId: avatarId })
        });
    }
</-script-->

<!-- Chores and Rewards -->

<h2>Chores</h2>

<table class="table table-striped">
    <thead>
    <tr>
        <th>Name</th>
        <th>Description</th>
        <th>Due Day</th>
        <th>Reward Points</th>
        <th>Complete</th>
    </tr>
    </thead>
    <tr th:each="chore : ${chores}">
        <td th:text="${chore.name}"></td>
        <td th:text="${chore.choreDescription}"></td>
        <td th:text="${chore.dueDay.displayName}"></td>
        <td th:text="${chore.rewardPoints}"></td>
        <td>
            <form th:action="@{/chores/markComplete}" method="post">
                <input type="hidden" name="choreId" th:value="${chore.id}" />
                <button type="submit" class="btn btn-primary">Mark Complete</button>
            </form>
        </td>
    </tr>
</table>

<h2>Earned Rewards</h2>

<table class="table table-striped">
    <thead>
    <tr>
        <th>Name</th>
        <th>Description</th>
        <th>Reward Points</th>
    </tr>
    </thead>
    <tr th:each="reward : ${earnedRewards}">
        <td th:text="${reward.name}"></td>
        <td th:text="${reward.description}"></td>
        <td th:text="${reward.points}"></td>
    </tr>
</table>


</body>
</html>